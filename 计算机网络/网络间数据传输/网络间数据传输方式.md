# 网络数据传输

## 内存拷贝

将客户端传输过来的数据拷贝到缓冲区，将缓冲区的数据交给处理函数，再由相应的处理函数对这部分的数据。

```c
enum FUNC_OPTIONS choice;
// 只使用memcpy复制前四个字节
memcpy((void *)&choice, readBuffer, sizeof(choice));
printf("choice:%d\n", choice);
switch (choice)
{
case REGIS:
    UserInfo *info = (UserInfo *)readBuffer;
    printf("info.type:%d\tinfo.userName:%s\tinfo.password:%s\n", info->type, info->userName, info->password);
    break;

case LOGIN:
    break;

default:
    break;
}
```

## JSON数据传输

JSON即JavaScript Object Notation(JavaScript对象表示法)。

它与XML相比更加轻量级，速度更快，且更易解析。

JSON独立于语言，JSON库支持多种编程语法。JSON是一种轻量级的数据交换格式，它是一种基于文本的数据格式，易于人类阅读和编写，同时也易于机器解析和生成。JSON格式由键值对组成，可以嵌套使用以表示复杂的数据结构。

#### 语法规则

JSON 语法是 JavaScript 对象表示语法的子集。

- 数据在**名称/值**对中
- 数据由逗号 **,** 分隔
- 使用斜杆 **\** 来转义字符
- 大括号 **{}** 保存对象
- 中括号 **[]** 保存数组，数组可以包含多个对象

#### 书写格式

JSON的书写格式是：key : value

类似哈希的形式，一个键对应一个值。

```json
"name" : "C语言"
```

#### JSON的值

JSON 值可以是：

- 数字（整数或浮点数）
- 字符串（在双引号中）
- 逻辑值（true 或 false）
- 数组（在中括号中）
- 对象（在大括号中）
- null

```json
// JSON数字
{ "age":30 } 

// json对象
{ "name":"菜鸟教程" , "url":"www.runoob.com" }  

// json数组
{
    "sites": [
        { "name":"菜鸟教程" , "url":"www.runoob.com" }, 
        { "name":"google" , "url":"www.google.com" }, 
        { "name":"微博" , "url":"www.weibo.com" }
    ]
}

// json布尔值
{ "flag":true }

// json字符串
{ "name":"菜鸟教程" , "url":"www.runoob.com" }
```

#### JSON使用

`json-c`库的函数使用：

##### 数据结构和类型定义：

1. ###### **json_object**:

   - 表示一个JSON对象，可以是对象、数组、字符串、数字或布尔值。
   - 它是一个不透明的指针类型，通常使用函数来创建和操作。

2. ###### **json_tokener**:

   - 用于将JSON字符串解析为JSON对象的解析器。
   - 内部使用，通常不需要直接操作。

3. ###### **json_object_iter**:

   - 表示JSON对象的迭代器，用于遍历JSON对象中的键值对。

##### 函数列表：

###### 1. JSON对象的创建和销毁：

- `json_object *json_object_new()`
  - 创建一个新的空JSON对象。
- `json_object *json_object_new_object()`
  - 创建一个新的JSON对象，类型为对象。
- `json_object *json_object_new_array()`
  - 创建一个新的JSON对象，类型为数组。
- `void json_object_put(json_object *obj)`
  - 销毁一个JSON对象及其关联的内存。

###### 2. JSON对象的操作：

- `enum json_type json_object_get_type(json_object *obj)`
  - 获取JSON对象的类型。
- `int json_object_object_add(json_object *obj, const char *key, json_object *val)`
  - 向JSON对象中添加键值对。
  - `obj`: 要添加键值对的JSON对象。
  - `key`: 新键的名称。
  - `val`: 新值的JSON对象。
- `json_object *json_object_object_get(json_object *obj, const char *key)`
  - 获取JSON对象中指定键对应的值。
  - `obj`: 要查找键值对的JSON对象。
  - `key`: 要查找的键名称。

###### 3. JSON数组的操作：

- `int json_object_array_length(json_object *obj)`
  - 获取JSON数组的长度。
  - `obj`: 要获取长度的JSON数组对象。
- `json_object *json_object_array_get_idx(json_object *obj, size_t i)`
  - 获取JSON数组中指定索引的元素。
  - `obj`: 要获取元素的JSON数组对象。
  - `i`: 要获取的元素的索引。

###### 4. JSON解析：

- `json_object *json_tokener_parse(const char *str)`
  - 解析JSON字符串并返回对应的JSON对象。
  - `str`: 要解析的JSON字符串。

###### 5. JSON生成：

- `const char *json_object_to_json_string(json_object *obj)`
  - 将JSON对象转换为JSON字符串。
  - `obj`: 要转换为字符串的JSON对象。
- `int json_object_to_file(const char *filename, json_object *obj)`
  - 将JSON对象写入到文件中。
  - `filename`: 要写入的文件名。
  - `obj`: 要写入文件的JSON对象。

###### 6. JSON值类型转换：

- `int json_object_get_boolean(json_object *obj)`
  - 获取JSON对象的布尔值。
  - `obj`: 要获取布尔值的JSON对象。
- `int json_object_get_int(json_object *obj)`
  - 获取JSON对象的整数值。
  - `obj`: 要获取整数值的JSON对象。
- `double json_object_get_double(json_object *obj)`
  - 获取JSON对象的浮点数值。
  - `obj`: 要获取浮点数值的JSON对象。
- `const char *json_object_get_string(json_object *obj)`
  - 获取JSON对象的字符串值。
  - `obj`: 要获取字符串值的JSON对象。

 [Json简单应用](./JsonUse/JsonUse.md) 





























































































